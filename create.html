<!DOCTYPE html>
<!--
All code in this file written by Caden O'Kellylee @Cesium72.
Don't steal my code!
-->
<html>
<head>
    <title>SURVEYit | Create Survey</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet"href="styles.css"/>
</head>
<body>
    <h1>SURVEY</h1>
    <div id="menu">
      <h3 style="color:black;">Menu</h3>
        <a href="/">Home</a><br/>
        <a href="create">Make a Survey</a><br/>
        <a href="history">Survey History</a><br/>
        <a href="/" onclick="localStorage.clear();">Logout</a>
    </div>
    <button onclick="changeMenu()" id="menuButton"></button>
    <div onclick="changeMenu()"id="shade"></div>
    <main>
        <h2>Create Survey</h2>
        <input id="header"placeholder="Main Header"/>
        <input id="sub"placeholder="Subheader"/>
        <center>Add between 2 and 8 Options</center><br>
        <input id="op1"placeholder="Option 1"/>
        <input id="op2"placeholder="Option 2"/>
        <input id="op3"placeholder="Option 3"/>
        <input id="op4"placeholder="Option 4"/>
        <input id="op5"placeholder="Option 5"/>
        <input id="op6"placeholder="Option 6"/>
        <input id="op7"placeholder="Option 7"/>
        <input id="op8"placeholder="Option 8"/>
        <br><br>
        <center>Select an image</center><br>
        <input type='file' />
        <br><center><img id="img" src="#"></center><br>
        <button onclick="submit()">Create Survey</button>
    </main>
    <script>
        const getVal = (input) => encodeURIComponent(document.getElementById(input).value);
        function submit() {
        if(!["header","sub","op1","op2"].map(a => getVal(a)).includes("")) {
            let finalAns = [1,2,3,4,5,6,7,8].map(a => getVal("op"+a)).filter(i => i != "");
fetch(`submit/${localStorage.getItem("uid")}/${getVal("header")}/${getVal("sub")}/${encodeURIComponent(base64Final.toString())}/${finalAns.join("/")}`);
        location.replace("."); } else {
        alert("Please fill out all fields!");
            }
        }
        var base64Final = "#";

        window.addEventListener('load', function() {
              document.querySelector('input[type="file"]').addEventListener('change', function() {
                  if (this.files && this.files[0]) {
                      var img = document.querySelector('img');
                      img.onload = () => {
                          URL.revokeObjectURL(img.src);
                      }
                      var a = URL.createObjectURL(this.files[0]);

                      let reader = new FileReader();
                      reader.readAsDataURL(this.files[0]);
                      reader.onloadend = () => {
                        img.src = reader.result;
                        base64Final = reader.result;
                      };
                       

                 
                  }
              });
        });

    </script>
    <script src="menu.js"></script>
</body>
</html>